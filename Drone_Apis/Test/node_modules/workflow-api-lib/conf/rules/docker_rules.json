{
	"base": null,
	"apis_files": ["/conf/apis/docker_v1.17-v1.12"],

	"scripts": {
		"@docker_containers": "/conf/scripts/docker_containers_script"
	},

	"rules": {
		"image_create": {
			"declare": {
				"@imageName": "#/image"
			},
			"version": "v1.17",
			"execute": [
				{
					"version": "v1.14",
					"api": "images",
					"queries": {
						"fromImage": "@imageName"
					},
					"success": { /* result or success and|or failed */
						"execute": [
							{
								"api": "create",
								"body": {
									"Image": "@imageName"
								},
								"success": {
									"declare": {
										"@containerId": "#/Id"
									},
									"execute": [
										{
											"api": "start",
											"path": {
												"id": "@containerId"
											}
										}
									]
								}
							}
						]
					}
				}
			]
		},

		"image_get": {
			"declare": {
				"@imageName": "#/image"
			},
			"version": "v1.17",
			"execute": [
				{
					"version": "v1.12",
					"api": "images",
					"path": {
						"name": "@imageName"
					},
					"success": { /* result or success and|or failed */
						"declare": {
							"@imageId": "#/Config/Image"
						}
					}
				}
			]
		},

		"container_create": {
			"declare": {
				"@imageName": "#/image",
				"@hostPort": "#/port",
				"@containerPort": "#/containerPort"
			},
			"version": "v1.17",
			"execute": [
				{
					"api": "create",
					"body": {
						"Image": "@imageName",
						"ExposedPorts": {
							"@containerPort/tcp": {}
						}
					},
					"success": {
						"declare": {
							"@containerId": "#/Id"
						},
						"execute": [
							{
								"api": "start",
								"path": {
									"id": "@containerId"
								},
								"body": {
									"PortBindings": {
										"@containerPort/tcp": [
											{ "HostPort": "@hostPort" }
										]
									}
								},
								"success": {
									"execute": [
										{
											"version": "v1.12",
											"api": "json",
											"name": "container_start_status",
											"path": {
												"id": "@containerId"
											},
											"result": {
												"script": "@docker_containers"
											},
											"success": {
												"execute": [
													{
														"version": "v1.13",
														"api": "top",
														"path": {
															"id": "@containerId"
														}
													}
												]
											}
										}
									]
								}
							}
						]
					}
				}
			]
		},

		"container_stop": {
			"declare": {
				"@containerId": "#/containerId"
			},
			"execute": [
				{
					"version": "v1.13",
					"api": "stop",
					"name": "container_stop",
					"path": {
						"id": "@containerId"
					},
					"result": {
						"script": "@docker_containers"
					}
				}
			]
		},

		"container_status": {
			"declare": {
				"@containerId": "#/containerId"
			},
			"execute": [
				{
					"version": "v1.12",
					"api": "json",
					"name": "container_status",
					"path": {
						"id": "@containerId"
					},
					"result": {
						"script": "@docker_containers"
					}
				}
			]
		},

		"container_delete": {
			"declare": {
				"@containerId": "#/containerId"
			},
			"execute": [
				{
					"version": "v1.14",
					"api": "delete",
					"path": {
						"id": "@containerId"
					},
					"queries": {
						"force": true,
						"v": 1
					}
				}
			]
		}
	}
}